import{_ as w}from"./Avatar.f79e45f0.js";import{e as C,o as a,f as r,m as f,h as _,t as x,i as P,F as v,r as $,p as S,l as O,b as h,k as B,v as M,x as R,c as k}from"./entry.9e251ea0.js";import{u as g,s as u,r as l,g as I,o as b}from"./index.b4dc6616.js";import{_ as V}from"./Cell.a2b43ae4.js";const z={props:{player:Object}},A={class:"player-card"};function G(s,e,t,o,n,i){const p=w;return a(),r("div",A,[f(p,{avatar:t.player.avatar,small:""},null,8,["avatar"]),_("h2",null,x(t.player.name),1)])}const H=C(z,[["render",G]]);const N={props:["code","players"],methods:{clipboard(){navigator.clipboard.writeText(this.$refs.link.innerText)}}},T=s=>(S("data-v-565eb63c"),s=s(),O(),s),D={class:"game-join"},F={class:"title"},J={class:"code"},Z=T(()=>_("h2",{class:"join text"},"Rejoignez la partie en allant sur",-1)),q={class:"players"};function E(s,e,t,o,n,i){const p=H;return a(),r("div",D,[_("h1",F,[P("Bienvenu dans le salon"),_("span",J,x(t.code),1)]),Z,_("h3",null,[_("span",{ref:"link"},"192.168.43.45:3000/"+x(t.code),513),P(),_("span",{class:"clipboard",onClick:e[0]||(e[0]=(...d)=>i.clipboard&&i.clipboard(...d))},"\u{1F4CB}")]),_("div",q,[(a(!0),r(v,null,$(t.players,(d,c)=>(a(),r("div",{key:c},[f(p,{player:d},null,8,["player"])]))),128))])])}const W=C(N,[["render",E],["__scopeId","data-v-565eb63c"]]);const K={props:["code","players"],data(){return{playersPositions:{},games:{sign:0,anus:0}}},methods:{getCoordinates(s){const e=[];for(var t=0,o=360/s,n=0;n<s;n++)e.push({x:window.innerWidth/2+Math.cos(t*Math.PI/180)*100,y:window.innerHeight/2+Math.sin(t*Math.PI/180)*100}),t+=o;return e},insideRectangle(s,e){return s.x>=e.left&&s.x<=e.right&&s.y>=e.top&&s.y<=e.bottom},refreshPosition(){var s;for(const[e,t]of Object.entries(this.players)){const o=(s=t.controller)==null?void 0:s.joystick;if(o!=null&&o.value){const n={x:this.playersPositions[e].x+o.value*-Math.cos(o.direction*Math.PI/180)/20,y:this.playersPositions[e].y+o.value*-Math.sin(o.direction*Math.PI/180)/20};if(this.$refs.map&&this.insideRectangle(n,this.$refs.map.getBoundingClientRect())){for(const i of this.$refs.games){const p=i.getBoundingClientRect(),d=this.insideRectangle({x:this.playersPositions[e].x,y:this.playersPositions[e].y},p),c=this.insideRectangle(n,p);d&&!c?this.games[i.dataset.name]--:!d&&c&&(this.games[i.dataset.name]++,this.games[i.dataset.name]==Object.keys(this.players).length&&this.start_the_game(i.dataset.name))}this.playersPositions[e].x=n.x,this.playersPositions[e].y=n.y}}}},start_the_game(s){const e=g();h(),u(l(e,`rooms/${this.code}/state`),"play_"+s)}},mounted(){const s=this.getCoordinates(Object.keys(this.players).length);for(const[o,n]of Object.entries(this.players))this.playersPositions[o]=s.pop();setInterval(()=>{this.refreshPosition()},1e3/60);const e=g(),t=h();u(l(e,`rooms/${t.params.code}/controller/type`),"joystick"),u(l(e,`rooms/${this.code}/game`),{})}},Q={class:"map",ref:"map"},U={class:"games"},X=["data-name"],Y={class:"number"};function ss(s,e,t,o,n,i){const p=w;return a(),r("div",null,[_("div",Q,[(a(!0),r(v,null,$(t.players,(d,c)=>{var y,m;return a(),r("div",{class:"player",key:c,style:B({left:((y=n.playersPositions[c])==null?void 0:y.x)+"px",top:((m=n.playersPositions[c])==null?void 0:m.y)+"px"})},[f(p,{avatar:d.avatar,small:""},null,8,["avatar"])],4)}),128)),_("div",U,[(a(!0),r(v,null,$(n.games,(d,c)=>(a(),r("div",{key:c,ref_for:!0,ref:"games",class:"game","data-name":c},[P(x(c)+" ",1),_("span",Y,x(d),1)],8,X))),128))])],512)])}const es=C(K,[["render",ss],["__scopeId","data-v-7557b698"]]);const ts={props:["settings"],data(){return{visible:!1}},mounted(){this.settings}},os={class:"sign-settings"},ns=_("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M13.8074 0H10.1927C9.52726 0 8.9878 0.537258 8.9878 1.2V2.00932C8.9878 2.52768 8.6503 2.98053 8.17268 3.18654C7.48751 3.48208 6.84357 3.85454 6.25186 4.293C5.83425 4.60245 5.27165 4.6671 4.82087 4.40789L4.11489 4.00195C3.5386 3.67058 2.80169 3.86723 2.46897 4.44118L0.661627 7.55887C0.328904 8.13283 0.526356 8.86673 1.10265 9.1981L1.80802 9.60369C2.2583 9.86261 2.48344 10.3794 2.42418 10.8938C2.38237 11.2568 2.36088 11.6259 2.36088 12C2.36088 12.3741 2.38237 12.7432 2.42418 13.1062C2.48345 13.6207 2.2583 14.1374 1.80802 14.3963L1.10265 14.8019C0.526356 15.1333 0.328904 15.8672 0.661627 16.4411L2.46897 19.5588C2.80169 20.1328 3.5386 20.3294 4.11489 19.9981L4.82088 19.5921C5.27167 19.3329 5.83426 19.3976 6.25187 19.707C6.84358 20.1455 7.48751 20.5179 8.17268 20.8135C8.6503 21.0195 8.9878 21.4723 8.9878 21.9907V22.8C8.9878 23.4627 9.52726 24 10.1927 24H13.8074C14.4728 24 15.0123 23.4627 15.0123 22.8V21.9907C15.0123 21.4723 15.3498 21.0195 15.8274 20.8135C16.5125 20.5179 17.1565 20.1455 17.7482 19.7071C18.1658 19.3976 18.7284 19.333 19.1791 19.5922L19.8851 19.9981C20.4614 20.3295 21.1983 20.1328 21.531 19.5589L23.3384 16.4412C23.6711 15.8672 23.4736 15.1333 22.8974 14.802L22.1921 14.3964C21.7418 14.1375 21.5166 13.6207 21.5759 13.1063C21.6177 12.7433 21.6392 12.3741 21.6392 12C21.6392 11.6259 21.6177 11.2567 21.5759 10.8937C21.5166 10.3793 21.7418 9.86253 22.1921 9.60361L22.8974 9.19807C23.4736 8.8667 23.6711 8.13279 23.3384 7.55884L21.531 4.44115C21.1983 3.8672 20.4614 3.67055 19.8851 4.00192L19.1792 4.40785C18.7284 4.66705 18.1658 4.60241 17.7482 4.29296C17.1565 3.85452 16.5126 3.48207 15.8274 3.18654C15.3498 2.98053 15.0123 2.52768 15.0123 2.00932V1.2C15.0123 0.537259 14.4728 0 13.8074 0ZM11.9465 18C15.2737 18 17.971 15.3137 17.971 12C17.971 8.68629 15.2737 6 11.9465 6C8.61928 6 5.92203 8.68629 5.92203 12C5.92203 15.3137 8.61928 18 11.9465 18Z",fill:"#fff4"},null,-1),as=[ns],rs={key:0,class:"settings"};function is(s,e,t,o,n,i){return a(),r("div",os,[_("div",null,[(a(),r("svg",{class:"gear",onClick:e[0]||(e[0]=p=>this.visible=!this.visible),viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},as)),n.visible?(a(),r("div",rs,x(t.settings),1)):M("",!0)])])}const ls=C(ts,[["render",is]]);const cs={props:["players","size"],data(){return{grid:[],signs:[],colors:[],turn:null,settings:{handSize:3,difficulty:0},win:!1}},async mounted(){const s=g(),e=h(),t=await I(l(s,`rooms/${e.params.code}/game/sign`));if(t.exists()){const o=t.val();this.grid=o.grid,this.colors=o.colors,this.signs=o.signs,this.main_plotline()}else{for(let o=0;o<this.size;o++)this.grid.push(Array(this.size).fill({sign:"",color:""}));this.signs=["hearth","star","moon","sun","triangle","circle","square"],this.colors=["#ff4444","#ffff44","#44ff44","#44ffff","#4444ff","#ff44ff","#666666","#dddddd"],u(l(s,`rooms/${e.params.code}/game/sign`),{grid:this.grid,signs:this.signs,colors:this.colors});for(const o of Object.keys(this.players)){let n=Array.from({length:this.settings.handSize},this.get_random_sign);u(l(s,`rooms/${e.params.code}/players/${o}/controller/sign/hand`),n)}this.main_plotline(),u(l(s,`rooms/${e.params.code}/controller`),{type:"sign",turn:Object.keys(this.players)[0]})}b(l(s,`rooms/${e.params.code}/game/sign/grid`),o=>{o.exists()&&(this.grid=o.val())})},methods:{async main_plotline(){const s=g(),e=h();b(l(s,`rooms/${e.params.code}/controller/turn`),t=>{t.exists()&&(this.turn=t.val())}),this.read_players()},read_players(){const s=g(),e=h();for(const t of Object.keys(this.players))b(l(s,`rooms/${e.params.code}/players/${t}/controller/sign/action`),async o=>{if(o.exists()&&t==this.turn){const n=o.val();console.log(`${t} a jou\xE9`),await this.place_sign(n,t),this.next_turn(t)}})},async place_sign(s,e){const t=g(),o=h(),n=await I(l(t,`rooms/${o.params.code}/players/${e}/controller/sign/hand/${s.index}`));if(n.exists()){const i=n.val();console.log(`${e} as mis son ${i.sign} ${i.color} sur la case ${s.y} : ${s.x}`),u(l(t,`rooms/${o.params.code}/game/sign/grid/${s.y}/${s.x}`),i),u(l(t,`rooms/${o.params.code}/players/${e}/controller/sign/action`),{}),u(l(t,`rooms/${o.params.code}/players/${e}/controller/sign/hand/${s.index}`),this.get_random_sign()),console.log("il/elle as \xE0 maintenant une nouvelle pi\xE8ce")}},next_turn(s){const e=g(),t=h(),o=Object.keys(this.players),n=o.indexOf(s)===o.length-1?o[0]:o[o.indexOf(s)+1];console.log(`c'est mainteanant \xE0 ${n} de jouer`),console.log(o,s),u(l(e,`rooms/${t.params.code}/controller/turn`),n)},get_random_sign(){return{sign:this.signs[Math.floor(Math.random()*this.signs.length)],color:this.colors[Math.floor(Math.random()*this.colors.length)]}}}},_s={class:"sign"},ds={class:"players"},ps={class:"grid"};function us(s,e,t,o,n,i){const p=ls,d=w,c=V;return a(),r("div",_s,[f(p,{settings:n.settings},null,8,["settings"]),_("div",ds,[(a(!0),r(v,null,$(t.players,(y,m)=>(a(),r("div",{class:"player",key:m},[f(d,{avatar:y.avatar,small:"",active:m==n.turn},null,8,["avatar","active"])]))),128))]),_("div",ps,[(a(!0),r(v,null,$(n.grid,(y,m)=>(a(),r("div",{key:m,class:"row"},[(a(!0),r(v,null,$(y,(j,L)=>(a(),r("div",{key:L,class:"cell"},[f(c,{color:j.color,sign:j.sign},null,8,["color","sign"])]))),128))]))),128))])])}const hs=C(cs,[["render",us],["__scopeId","data-v-3d112eb5"]]);R(null);const gs={data(){return{players:[],state:null,code:null}},mounted:function(){const s=g(),e=h();this.code=e.params.code,b(l(s,`rooms/${this.code}/players`),t=>{this.players=t.val()}),b(l(s,`rooms/${this.code}/state`),t=>{this.state=t.val()})}};function ms(s,e,t,o,n,i){const p=W,d=es,c=hs;return a(),r("div",null,[n.state=="settings"?(a(),k(p,{key:0,code:n.code,players:n.players},null,8,["code","players"])):n.state=="player_ready"?(a(),k(d,{key:1,code:n.code,players:n.players},null,8,["code","players"])):n.state=="play_sign"?(a(),k(c,{key:2,code:n.code,players:n.players,size:8},null,8,["code","players"])):M("",!0)])}const xs=C(gs,[["render",ms],["__scopeId","data-v-32c3bfc3"]]);export{xs as default};
